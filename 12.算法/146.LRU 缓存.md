# LeetCode ğŸ‘‰ HOT 100 ğŸ‘‰ LRU ç¼“å­˜ - ä¸­ç­‰é¢˜

## é¢˜ç›®

è¯·ä½ è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ»¡è¶³Â **LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜** çº¦æŸçš„æ•°æ®ç»“æ„ã€‚
å®ç° LRUCache ç±»ï¼š
- LRUCache(int capacity) ä»¥ æ­£æ•´æ•° ä½œä¸ºå®¹é‡Â capacity åˆå§‹åŒ– LRU ç¼“å­˜
- int get(int key) å¦‚æœå…³é”®å­— key å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› -1 ã€‚
- void put(int key, int value)Â å¦‚æœå…³é”®å­—Â key å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼Â value ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å‘ç¼“å­˜ä¸­æ’å…¥è¯¥ç»„Â key-value ã€‚å¦‚æœæ’å…¥æ“ä½œå¯¼è‡´å…³é”®å­—æ•°é‡è¶…è¿‡Â capacity ï¼Œåˆ™åº”è¯¥ é€å‡º æœ€ä¹…æœªä½¿ç”¨çš„å…³é”®å­—ã€‚

å‡½æ•° **get** å’Œ **put** å¿…é¡»ä»¥ **O(1)** çš„å¹³å‡æ—¶é—´å¤æ‚åº¦è¿è¡Œã€‚


**ç¤ºä¾‹**

    è¾“å…¥
    ["LRUCache", "put", "put", "get", "put", "get", "put", "get", "get", "get"]
    [[2], [1, 1], [2, 2], [1], [3, 3], [2], [4, 4], [1], [3], [4]]

    è¾“å‡º
    [null, null, null, 1, null, -1, null, -1, 3, 4]

    è§£é‡Š
    LRUCache lRUCache = new LRUCache(2);
    lRUCache.put(1, 1); // ç¼“å­˜æ˜¯ {1=1}
    lRUCache.put(2, 2); // ç¼“å­˜æ˜¯ {1=1, 2=2}
    lRUCache.get(1);    // è¿”å› 1
    lRUCache.put(3, 3); // è¯¥æ“ä½œä¼šä½¿å¾—å…³é”®å­— 2 ä½œåºŸï¼Œç¼“å­˜æ˜¯ {1=1, 3=3}
    lRUCache.get(2);    // è¿”å› -1 (æœªæ‰¾åˆ°)
    lRUCache.put(4, 4); // è¯¥æ“ä½œä¼šä½¿å¾—å…³é”®å­— 1 ä½œåºŸï¼Œç¼“å­˜æ˜¯ {4=4, 3=3}
    lRUCache.get(1);    // è¿”å› -1 (æœªæ‰¾åˆ°)
    lRUCache.get(3);    // è¿”å› 3
    lRUCache.get(4);    // è¿”å› 4

## æ€è·¯

é¦–å…ˆç†è§£é¢˜ç›®æ„æ€ï¼Œè¦å®ç°ä¸€ä¸ªå‚¨å­˜æ•°æ®çš„ç±»ï¼Œè¦æ±‚å¦‚ä¸‹

- 1ã€æœ‰æœ€å¤§å­˜å‚¨é‡é™åˆ¶ `capacity`
  
- 2ã€å¯ä»¥é€šè¿‡ `get(key)` æ–¹æ³•è¿”å›å¯¹åº”çš„å€¼
  
- 3ã€å¯ä»¥é€šè¿‡ `put(key, value)` å­˜ä¸‹å¯¹åº”æ•°æ®
  
- 4ã€å½“è°ƒç”¨ `put` æ–¹æ³•æ—¶ï¼Œå¦‚æœè¶…å‡ºæœ€å¤§å­˜å‚¨é‡ `capacity`ï¼Œåˆ™éœ€è¦å°† `æœ€è¿‘æœ€å°‘ä½¿ç”¨` çš„æ•°æ®åˆ é™¤
  
å…³é”®ç‚¹åœ¨ç¬¬4ç‚¹ï¼Œä»€ä¹ˆå« `æœ€è¿‘æœ€å°‘ä½¿ç”¨`ï¼ŒæŒ‰ç…§é¢˜ç›®æ„æ€åº”è¯¥ä¸ºï¼šå¦‚æœä¸€ä¸ªæ•°æ®è¢«ä½¿ç”¨äº†ï¼Œæ— è®ºæ˜¯ `get` ï¼Œè¿˜æ˜¯ `put`ï¼Œé‚£ä¹ˆå®ƒåœ¨æ‰€æœ‰æ•°æ®ä¸­çš„æ’åºï¼Œåº”è¯¥ç§»åŠ¨åˆ°æœ€å‰é¢ï¼›é‚£ä¹ˆæ¯æ¬¡éœ€è¦åˆ é™¤æ•°æ®æ—¶ï¼Œåº”è¯¥ä»æ’åºä¸­ï¼Œé€‰æ‹©æ’åºæœ€å°¾éƒ¨çš„æ•°æ®ã€‚

å¦‚æœä¸è€ƒè™‘ `getã€set` çš„æ“ä½œæ—¶é—´å¤æ‚åº¦çš„é—®é¢˜ï¼ŒJsè¯­è¨€ä¸­ï¼Œæœ‰ä¸€ä¸ª `Map` çš„æ•°æ®ç»“æ„åˆšå¥½ç¬¦åˆä¸Šé¢çš„ç‰¹æ€§ï¼š`Map` é‡Œé¢çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼ŒæŒ‰ç…§æ¯æ¬¡æ’å…¥çš„é¡ºåºå‘åæ’åˆ—ï¼›æŒ‰ç…§é¢˜æ„ï¼Œå¯ä»¥å®ç°å¦‚ä¸‹ï¼š

- 1ã€å®ç° `get`ï¼šå¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› -1ï¼›å¦‚æœå­˜åœ¨ï¼Œå…ˆè·å–å€¼ `value`ï¼Œå†ä»ç¼“å­˜ä¸­åˆ é™¤è¯¥ `key`ï¼Œå†æ’å…¥è¯¥ `key, value` æ•°æ®ï¼Œæœ€åè¿”å› `value`ï¼›è¿™æ ·åšçš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†å°†è¯¥æ•°æ®çš„ä½ç½®ï¼Œåˆ·æ–°åˆ°æœ€å‰é¢

- 2ã€å®ç° `push`ï¼šå¦‚æœç¼“å­˜ä¸­å‡ºåœ¨è¯¥ `key`ï¼Œå…ˆåˆ é™¤ï¼›å†å°†æ•°æ®æ”¾å…¥ç¼“å­˜ä¸­ï¼ˆ**ä¸ºäº†åˆ·æ–°è¯¥æ•°æ®çš„ä½ç½®**ï¼‰ï¼›æœ€ååˆ¤æ–­ç¼“å­˜æ•°æ®çš„é•¿åº¦ï¼Œæ˜¯å¦å¤§äºæœ€å¤§å­˜å‚¨é‡ï¼Œæ»¡è¶³çš„è¯ï¼Œåˆ©ç”¨ `Map.keys().next().value` è·å–å¯¹åº”çš„ `æœ€è¿‘æœ€å°‘ä½¿ç”¨` çš„æ•°æ® `key`ï¼Œåˆ é™¤è¯¥æ•°æ®

å…³äº `.next()` æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒ `MDN` å¯¹äºè¯¥Apiçš„è§£é‡Šï¼Œ[`ä¼ é€é—¨ â˜`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map/keys)

```js
    /**
     * @param {number} capacity
     */
    var LRUCache = function (capacity) {
        this.map = new Map();
        this.capacity = capacity;
    };

    /** 
     * @param {number} key
     * @return {number}
     */
    LRUCache.prototype.get = function (key) {
        if(this.map.has(key)) {
            let value = this.map.get(key);
            this.map.delete(key);
            this.map.set(key, value);
            return value;
        } else {
            return -1;
        }
    };

    /** 
     * @param {number} key 
     * @param {number} value
     * @return {void}
     */
    LRUCache.prototype.put = function (key, value) {
        if(this.map.has(key)) {
            this.map.delete(key);
        }
        this.map.set(key, value);
        if(this.map.size > this.capacity) {
            this.map.delete(this.map.keys().next().value);
        }
    };
```

**æ€è€ƒï¼š** å¦‚æœè¦å®ç°é¢˜ç›®è¦æ±‚çš„ **get** å’Œ **put** å¿…é¡»ä»¥ **O(1)** çš„å¹³å‡æ—¶é—´å¤æ‚åº¦è¿è¡Œï¼Œé‚£ä¹ˆå°±è¦ç”¨åˆ° `åŒå‘é“¾è¡¨ + å“ˆå¸Œè¡¨`ï¼Œä¸ºä»€ä¹ˆï¼š

- 1ã€å¯¹äº `get` æ–¹æ³•ï¼Œå¦‚æœæƒ³è¾¾åˆ°æ—¶é—´å¤æ‚åº¦ä¸º `O(1)`ï¼Œ`å“ˆå¸Œè¡¨` æ˜¯æ»¡è¶³æ¡ä»¶çš„ã€‚
  
- 2ã€å› ä¸ºå­˜åœ¨æœ€å¤§å®¹é‡çš„é™åˆ¶ï¼Œåœ¨ `put` è¿‡ç¨‹ä¸­å¿…ç„¶å­˜åœ¨è¶…è¿‡æ•°é‡æ—¶ï¼Œè¦è¿›è¡Œåˆ é™¤æ“ä½œ

- 3ã€å¯¹äºåˆ é™¤æ“ä½œï¼š
  
  - æ•°ç»„ç»“æ„ï¼Œæ’å…¥ã€åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸º `O(n)`ï¼Œä¸å¯å–
  - å•å‘é“¾è¡¨ï¼Œåœ¨åˆ é™¤æ—¶ï¼Œéœ€è¦æ‰¾åˆ°å½“å‰èŠ‚ç‚¹çš„å‰åºèŠ‚ç‚¹ï¼ŒèŠ±è´¹ `O(n)`ï¼Œä¸å¯å–
  - åŒå‘é“¾è¡¨ï¼Œè·å–å‰åºèŠ‚ç‚¹çš„æ—¶é—´ä¸º `O(1)`ï¼Œåˆ é™¤ä¹Ÿåªéœ€è¦å°†å‰åºèŠ‚ç‚¹çš„ä¸‹ä¸€èŠ‚ç‚¹æŒ‡å‘å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€èŠ‚ç‚¹å³å¯

å…·ä½“å®ç°å¦‚ä¸‹ï¼š

```js
    // å®šä¹‰åŒå‘é“¾è¡¨ç»“æ„
    function ListNode(key, value) {
        this.key = key;
        this.value = value;
        this.next = null;
        this.prev = null;
    }

    /**
     * @param {number} capacity
     */
    var LRUCache = function (capacity) {
        this.hash = {}; // å“ˆå¸Œè¡¨
        this.capacity = capacity;
        this.size = 0;

        // é»˜è®¤å¤´ã€å°¾èŠ‚ç‚¹
        this.root = new ListNode('start', 'start');
        this.end = new ListNode('end', 'end');
        this.root.next = this.end;
        this.end.prev = this.root;

        // ä»é“¾è¡¨åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹
        this.removeNode = node => {
            const prev = node.prev;
            const next = node.next;
            prev.next = next;
            next.prev = prev;
        }

        // æŠŠèŠ‚ç‚¹æ·»åŠ åˆ°å¤´éƒ¨
        this.addToHead = node => {
            const head = this.root.next;
            this.root.next = node;
            node.prev = this.root;
            node.next = head;
            head.prev = node;
        }

        // æŠŠèŠ‚ç‚¹ç§»åŠ¨åˆ°å¤´éƒ¨
        // å…ˆåˆ é™¤ï¼Œåç§»åŠ¨
        this.addHead = node => {
            this.removeNode(node);
            this.addToHead(node);
        }

        // ç§»é™¤æœ€åä¸€ä¸ªèŠ‚ç‚¹
        this.popEnd = () => {
            let node = this.end.prev;
            this.removeNode(node);
            return node;
        }

        // åˆ é™¤ç¼“å­˜çš„item æ•°æ®
        this.removeLRUItem = () => {
            let node = this.popEnd();
            delete this.hash[node.key];
            this.size--;
        }
    };

    /** 
     * @param {number} key
     * @return {number}
     */
    LRUCache.prototype.get = function (key) {
        
        const node = this.hash[key];

        if(!node) return -1;
        this.addHead(node);
        return node.value;
    };

    /** 
     * @param {number} key 
     * @param {number} value
     * @return {void}
     */
    LRUCache.prototype.put = function (key, value) {
        let node = this.hash[key];
        if(!node) {

            if(this.size == this.capacity) {
                this.removeLRUItem();
            }

            node = new ListNode(key, value);
            this.addToHead(node);
            this.hash[key] = node;
            this.size++;

        } else {
            node.value = value;
            this.addHead(node);
        }
    };
```

## å°ç»“

åŒå‘é“¾è¡¨çš„ç‰¹æ€§ä¸ºï¼Œä»å…¶ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„è·å–å®ƒçš„å‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¯¹äºåˆ é™¤æ“ä½œï¼ŒåŒå‘é“¾è¡¨çš„æ—¶é—´å¤æ‚åº¦å¯ä»¥é™ä¸º `O(1)`

[LeetCode ğŸ‘‰ HOT 100 ğŸ‘‰ LRU ç¼“å­˜ - ä¸­ç­‰é¢˜](https://leetcode-cn.com/problems/lru-cache/) âœ…


[åˆé›†ï¼šLeetCode ğŸ‘‰ HOT 100](https://juejin.cn/column/7029946677398077476)ï¼Œæœ‰ç©ºå°±ä¼šæ›´æ–°ï¼Œå¤§å®¶å¤šå¤šæ”¯æŒï¼Œç‚¹ä¸ªèµğŸ‘

å¦‚æœå¤§å®¶æœ‰å¥½çš„è§£æ³•ï¼Œæˆ–è€…å‘ç°æœ¬æ–‡ç†è§£ä¸å¯¹çš„åœ°æ–¹ï¼Œæ¬¢è¿ç•™è¨€è¯„è®º ğŸ˜„

