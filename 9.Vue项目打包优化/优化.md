# Vue é¡¹ç›®ä¼˜åŒ–ï¼ˆæœ€ç»ˆè¾“å‡ºæ–¹å‘ï¼‰

## èƒŒæ™¯

æˆ‘ä»¬æœ‰ä¸€ä¸ªå¾®ä¿¡å°ç¨‹åºï¼Œåœ¨è¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†èµ¶è¿›åº¦ï¼Œæœ€åˆé‡Œé¢å¤§éƒ¨åˆ†é¡µé¢éƒ½æ˜¯åˆ©ç”¨ `web-view` ç»„ä»¶åµŒå¥—h5ç«™ç‚¹æ¥å®ç°çš„ï¼›h5ç«™ç‚¹ï¼Œå°±æ˜¯åˆ©ç”¨çš„vue-cliå®˜æ–¹é‚£ä¸€å¥—æ­å»ºçš„å•é¡µé¢åº”ç”¨ï¼›éšç€é¡¹ç›®çš„æ¨è¿›ï¼Œè¿­ä»£çš„èŠ‚å¥å¼€å§‹æ…¢ä¸‹æ¥ï¼Œè€ç”Ÿå¸¸è°ˆçš„å‰ç«¯é¡¹ç›®ä¼˜åŒ–é—®é¢˜ï¼Œç»ˆäºè¢«æä¸Šäº†æ—¥ç¨‹ï¼ˆä¸»è¦æœ‰äººåæ§½åŠ è½½å¤ªæ…¢äº†ï¼‰

## è°ƒç ”

ç”±äºh5ç«™ç‚¹æ˜¯ç”¨å¾®ä¿¡å°ç¨‹åº web-view ç»„ä»¶æ¸²æŸ“ï¼Œæ‰€ä»¥æ›¾ç»æœ‰ä¸€ä¸ªæ–¹å‘æ˜¯å»çœ‹å¾®ä¿¡æ–‡æ¡£ï¼Œå»å°ç¨‹åºç¤¾åŒºçœ‹çœ‹ï¼Œæœ‰æ²¡æœ‰è§£å†³æ–¹æ³•ï¼Œç”±æ­¤æ‰¾åˆ°äº†ä¸‹é¢å‡ ç¯‡æ–‡ç« 

- [å®‰å“web-viewåŠ è½½é¡µé¢æ…¢ï¼Œä¸€ç›´ç©ºç™½ã€‚ä½†æ˜¯è‹¹æœæ‰‹æœºå¯ä»¥æ‰“å¼€ï¼Œæ€ä¹ˆè§£å†³](https://developers.weixin.qq.com/community/develop/doc/000c8c5f9ac28037c01801a195fc00?highLine=webview%25E5%258A%25A0%25E8%25BD%25BD%25E6%2585%25A2)

- [å°ç¨‹åºweb-viewæ‰“å¼€h5 åŠ è½½å¾ˆæ…¢ï¼Ÿ é¡¶éƒ¨ç»¿è‰²è¿›åº¦æ¡ä¸€ç›´åŠ è½½ æ²¡åŠ è½½å®Œæˆ è·³è½¬åˆ°å°ç¨‹åºæ–¹æ³•ä¸æ‰§](https://developers.weixin.qq.com/community/develop/doc/0002245813c9485a570bd644b57800?highLine=webview%25E5%258A%25A0%25E8%25BD%25BD%25E6%2585%25A2)

- [iosé¦–æ¬¡åŠ è½½web-viewç¼“æ…¢ï¼Ÿ](https://developers.weixin.qq.com/community/develop/doc/000ac2267a043823f96b1bf385b800?highLine=webview%25E5%258A%25A0%25E8%25BD%25BD%25E6%2585%25A2)

åˆ†æè¿‡åï¼Œå…¶å®å¤§éƒ¨åˆ†çš„é—®é¢˜å¥½åƒéƒ½å’Œweb-viewç»„ä»¶å…³ç³»ä¸æ˜¯å¾ˆå¤§ï¼Œé‚£è¿˜æ˜¯å›åˆ°h5ç«™ç‚¹é¡¹ç›®çš„ä¼˜åŒ–ä¸Šå§

## è½åœ°æ–¹æ¡ˆ

ç›´æ¥ä¸Šç»“è®ºï¼Œä¼˜åŒ–çš„éƒ¨åˆ†ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªç‚¹ï¼š

### å•é¡µé¢åº”ç”¨è½¬å¤šé¡µé¢ï¼ˆå¤šå…¥å£ï¼‰

é¡¹ç›®ç»è¿‡å‡ ä¸ªè¿­ä»£ä¹‹åï¼Œå¾ˆå¤šh5ç«™ç‚¹çš„é¡µé¢éƒ½è¢«æŠ›å¼ƒäº†ï¼Œæˆ–è¢«åŸç”Ÿé‡å†™ï¼›é‚£ä¹ˆæ­¤åˆ»å•é¡µé¢åº”ç”¨ï¼Œå¯¹äºh5ç«™ç‚¹çš„åŠ è½½é€Ÿåº¦ï¼Œä¼šæœ‰å¾ˆå¤§å½±å“ï¼›å› ä¸ºé‚£äº›ç”¨ä¸ä¸Šçš„é¡µé¢jsï¼Œå¼•ç”¨çš„ç¬¬ä¸‰æ–¹åº“æˆ–è€…ç»„ä»¶ï¼Œå¯èƒ½ä¼šè¢«æ‰“å…¥ vendor.js ä¸­ï¼Œå¯¼è‡´æ•´ç†åŒ…ä½“ç§¯è¿‡å¤§ã€‚

- 1ã€å»é™¤ vue-router

- 2ã€ç”Ÿæˆå„ä¸ªå…¥å£æ–‡ä»¶çš„jsæ–‡ä»¶ ï¼ˆè¿™é‡Œæ˜¯ç”¨ node å†™çš„è„šæœ¬ï¼Œç›®çš„å°±æ˜¯ç”Ÿæˆç±»ä¼¼äº main.js çš„å…¥å£æ–‡ä»¶ï¼‰

- 2ã€é…ç½® vue.config.js

```js
    // vue.config.js
    const glob = require('glob');
    const path = require('path');

    // è·å–æ‰€æœ‰çš„é¡µé¢å…¥å£æ–‡ä»¶
    // æœ¬é¡¹ç›®æ‰€æœ‰å…¥å£jsæ–‡ä»¶éƒ½ä»¥ `Html.js` ç»“å°¾ ä¸”éƒ½åœ¨ views æ–‡ä»¶å¤¹ä¸‹
    const PAGE_PATH = path.resolve(__dirname, './src/views/**/*Html.js')

    const pages = {};

    // åˆ©ç”¨ glob.sync éå†æ–‡ä»¶ï¼Œç»„æˆå¦‚ä¸‹pages ç»“æ„
    /** 
     *  pages = {
            index: 'src/views/indexHtml.js',
            home: 'src/views/homeHtml.js',
            cart: 'src/views/cartHtml.js',
        }
    */
    glob.sync(PAGE_PATH).forEach(filePath => {
        var filename = filePath.replace(/(.*)src\/(.*)\/(.*)Html\.js/,'$3');
        var fileAbsolutePath = filePath.replace(/(.*)src\/views\/(.*)\.js/,'$2');
        pages[filename.toLowerCase()] = `src/views/${fileAbsolutePath}.js`
    })

    module.exports = {
        // ...code
        pages
        // ...code
    }
```

ä¸Šé¢çš„ `pages` é¡¹ï¼Œè¿™ä¹ˆé…ç½®ä¹‹åï¼Œæ„å»ºå®Œæˆä¹‹åå°±ä¼šç”Ÿæˆå¤šä¸ª `[entry].html`æ–‡ä»¶ï¼Œä½†æ˜¯æ¨¡ç‰ˆéƒ½æ˜¯ç”¨çš„ `public/index.html`ï¼ˆåŸ‹ä¸‹äº†å‘ï¼‰

### åˆ†æä¾èµ– -> chunk-vendor.js è¿‡å¤§

é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ç”¨åˆ°äº†çš„ç¬¬ä¸‰æ–¹åº“æœ‰ `vue`ã€`echarts`ã€`tim-js-sdk`ã€`js-cookies`

ä¸Šé¢è¿™äº›ç¬¬ä¸‰æ–¹åº“ï¼Œé»˜è®¤éƒ½è¢«æ„å»ºæ‰“åŒ…åˆ°chunk-vendor.jsä¸­ï¼Œæ‰€ä»¥è¿™ä¸ªjsæ˜¾å¾—æ ¼å¤–çš„å¤§ï¼Œå¹¶ä¸”å®ƒè¢«å„ä¸ªå…¥å£çš„.htmlæ–‡ä»¶å¼•ç”¨

äºæ˜¯æˆ‘ä»¬æŠŠè¿™äº›åŒ…å•ç‹¬ç”¨ script æ ‡ç­¾ï¼Œåœ¨index.htmlé‡Œå¼•å…¥ï¼Œå¹¶é…ç½® `configureWebpack.externals`ï¼Œä»è€Œå‡å° chunk-vendor.js çš„ä½“ç§¯

é…ç½®æ–¹æ³•å¯ä»¥å‚è€ƒ [å¤–éƒ¨æ‰©å±•(Externals)](https://webpack.docschina.org/configuration/externals/)

```js
    // vue.config.js
    let webpackConfig = {
        // ...code

        // ...code
    }
    if(process.env.NODE_ENV === 'production') {
        webpackConfig.configureWebpack.externals = {
            'vue':"Vue",
            'echarts':'echarts',
            // ...
        }
    }
    module.exports = webpackConfig
```

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜åšäº†ä¸€ä»¶äº‹ï¼Œä¿®æ”¹äº† index.html

```html
    <!DOCTYPE html>
    <html lang="cn">

    <head>
    </head>

    <body>
        <noscript>
            <strong>We're sorry but vue-base doesn't work properly without JavaScript enabled. Please enable it to
                continue.</strong>
        </noscript>
        <div id="app"></div>

        <% if(process.env.NODE_ENV==='production' ){ %>
            <script src="<%= process.env.VUE_APP_publicPath %>/vue.runtime.min.js"></script>
            <script src="<%= process.env.VUE_APP_publicPath %>/echarts.min.js"></script>
        <% } %>
    </body>

    </html>
```

!!! å¯ä»¥çœ‹å‡ºï¼Œåªæœ‰åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æ‰ä¼šå¯ç”¨ `externals` é…ç½®ï¼ŒåŸå› æ˜¯ï¼šå…¬å¸ç½‘ç»œä¸å¥½ï¼Œå¤–éƒ¨jså¼•å…¥è€æ˜¯è¶…æ—¶ ğŸ˜¢ğŸ˜¢ğŸ˜¢

### å¼‚æ­¥å¼•å…¥ç»„ä»¶

`å¼‚æ­¥ç»„ä»¶`ï¼Œå¯ä»¥çœ‹æˆ‘è¿™ç¯‡æ–‡ç«  [Vue å¼‚æ­¥ç»„ä»¶å’ŒåŠ¨æ€ç»„ä»¶ï¼ˆ2.xï¼‰](https://juejin.cn/post/7025498573118636062)

ä¸€äº›éé¦–å±éœ€è¦ç”¨åˆ°ï¼Œä¸”ä½“ç§¯è¿‡å¤§çš„ç»„ä»¶ï¼Œå¯ä»¥å¼‚æ­¥å¼•å…¥ï¼›åªæœ‰åœ¨ç»„ä»¶è¢«ç”¨åˆ°çš„æ—¶å€™ï¼Œæ‰ä¼šå»å¼‚æ­¥è¯·æ±‚ï¼ˆajaxï¼‰ï¼›

```
    // xxx.vue
    <script>
        import LargeAndNotNeedComp from '../components/LargeAndNotNeedComp.vue'
        
        // ...code

        export default {
            name:'CreatPatient',
            components:{LargeAndNotNeedComp},

            // ...code
        }
    </script>

    // æ”¹å†™ä¸º ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡

    <script>

        // ...code

        export default {
            name:'CreatPatient',
            components:{
                'LargeAndNotNeedComp': () => import('../components/LargeAndNotNeedComp.vue')
            },

            // ...code
        }
    </script>
```

### å…¶ä»–ä¼˜åŒ–

å…¶ä»–ä¼˜åŒ–æ‰‹æ®µè¿˜æœ‰ `è·¯ç”±æ‡’åŠ è½½`ï¼Œ`cdn`ï¼Œ`terser åˆ é™¤æ³¨é‡Šã€console` ï¼Œç”±äºé¡¹ç›®å»ºç«‹åˆæœŸå°±å·²ç»åšäº†ï¼Œå°±ä¸ä»‹ç»äº†

### å¡«å‘

åœ¨ç¬¬ä¸€æ­¥ [`å•é¡µé¢åˆ°å¤šé¡µé¢`] å’Œ ç¬¬äºŒæ­¥ [`åˆ†æä¾èµ–`] çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®åŸ‹ä¸‹äº†ä¸€ä¸ªä¸å°çš„å‘ï¼›

ç”±äº `public/index.html` æ˜¯æ‰€æœ‰å…¥å£æ–‡ä»¶çš„å…¬å…±é¡µé¢ï¼Œåœ¨æˆ‘ä»¬æŠŠè®¸å¤šç¬¬ä¸‰æ–¹åº“ç”¨ `configureWebpack.externals` é…ç½®é¡¹ï¼Œä»chunk-vendor.jsä¸­æ‹†å‡ºï¼Œæ”¾å…¥ `public/index.html` å¼‚æ­¥å¼•å…¥çš„è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰è€ƒè™‘åˆ°å¾ˆå¤šé¡µé¢å…¶å®ç”¨ä¸ä¸Šè¿™äº›åº“ï¼Œä½†ä¹Ÿå¼•å…¥äº†ï¼Œé€ æˆäº†ä¸å°çš„é—®é¢˜ï¼›

æœ€åè°ƒæ•´é…ç½®ï¼ŒåªæŠŠæ‰€æœ‰é¡µé¢éƒ½éœ€è¦çš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œæ‰æ”¾å…¥ `configureWebpack.externals` ä¸­ï¼Œå¦‚ `Vue`ï¼›ä¸€äº›ç‰¹æ®Šé¡µé¢éœ€è¦ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹åº“ï¼Œä¾ç„¶é‡‡ç”¨importçš„æ–¹å¼å¼•å…¥ï¼ˆäºŒä¸‰çº§é¡µé¢ï¼‰ï¼Œå¹¶è°ƒæ•´ `vue.config.js`

```js

    let pages = {};

    // ...code


    let webpackConfig = {

        // ...code


        chainWebpack: config => {
            config.optimization.splitChunks({
                cacheGroups: {
                    vendors: {
                        name: 'chunk-vendors',
                        minChunks: Object.keys(pages).length,
                        test: /node_modules/,
                        priority: -10,
                        chunks: 'initial'
                    },
                    common: {}
                }
            });
        }
    }
```

ä¸Šæ–¹çš„å…³é”®é…ç½®åœ¨ `minChunks: Object.keys(pages).length`ï¼Œè¡¨ç¤ºåªæœ‰æ‰€æœ‰é¡µé¢éƒ½ç”¨åˆ°äº†çš„æ¨¡å—ï¼ˆnode_modulesé‡Œï¼‰ï¼Œæ‰ä¼šè¢«æ„å»ºåˆ°chunk-vendor.jsä¸­

# æ€»ç»“

ä¼˜åŒ–çš„ç›®çš„ï¼Œå…¶å®å°±æ˜¯è¦è§£å†³åŠ è½½æ…¢çš„é—®é¢˜ï¼›

>é‚£ä¹ˆå¦‚æœé¡¹ç›®çš„èµ„æºä½“ç§¯å°äº†ï¼Œæ•´ä½“åŠ è½½è‡ªç„¶å°±ä¼šå¿«ï¼›

>ä¸€ä¸ªå¾ˆå¤§çš„jsæ–‡ä»¶ï¼Œæ‹†åˆ†æˆå¤šä¸ªå°æ–‡ä»¶ï¼Œå¹¶è¡ŒåŠ è½½ï¼Œæ•´ä½“åŠ è½½ä¹Ÿä¼šå¿«ï¼›

>å»é™¤ç”¨ä¸ä¸Šçš„æ–‡ä»¶ï¼Œæˆ–è€…è¯´ç”¨åˆ°äº†å†åŠ è½½ï¼Œé¦–æ¬¡æ•´ä½“åŠ è½½ä¹Ÿä¼šå¿«ï¼›

>è¿˜æœ‰ï¼Œå¦‚æœè¯·æ±‚è¿‡ä¸€æ¬¡ï¼Œä¸‹æ¬¡èƒ½åˆ©ç”¨ç¼“å­˜ï¼Œé‚£æ•´ä½“åŠ è½½ä¹Ÿä¼šå¿«

# ç»“æœ

æŸä¸ªé¡µé¢çš„ä¼˜åŒ–å‰åå¯¹æ¯”ï¼š

```
    ä¼˜åŒ–å‰ï¼š

        jsæ–‡ä»¶è¯·æ±‚æ•°é‡ï¼š12

        jsåŠ è½½æ€»å¤§å°ï¼š777kb
        
        domåŠ è½½å®Œæˆæ—¶é—´ï¼š711ms

        
    ä¼˜åŒ–åï¼š

        jsæ–‡ä»¶è¯·æ±‚æ•°é‡ï¼š6

        jsåŠ è½½æ€»å¤§å°ï¼š237kb
        
        domåŠ è½½å®Œæˆæ—¶é—´ï¼š282ms
```